name = "voidcat-grant-search-api"
main = "src/index.js"
compatibility_date = "2024-01-01"

# Phase 2A Feature Flags - Production Reality Integration
[vars]
FEATURE_LIVE_DATA = false  # Enable in staging first, then production
FEATURE_REAL_AI = false    # Enable in staging first, then production

# Bindings for local development
[[d1_databases]]
binding = "VOIDCAT_DB"
database_name = "voidcat-users"
database_id = "b22bd380-29ca-4a22-be8a-655a382a58a1"

[[kv_namespaces]]
binding = "OAUTH_KV"
id = "ae1f4c3087dd4b208a449f7fbd7c93d3"

# Phase 2A: Federal data caching (12-hour TTL)
# [[kv_namespaces]]
# binding = "FEDERAL_CACHE"
# id = "REPLACE_WITH_ID_FROM_SETUP_SCRIPT"

[[r2_buckets]]
binding = "ASSETS"
bucket_name = "voidcat-assets"

[env.production]
name = "grant-search-api"

# Production feature flags - Enable after staging validation
[env.production.vars]
ENVIRONMENT = "production"
FEATURE_LIVE_DATA = false
FEATURE_REAL_AI = false

# Phase 2A: Staging Environment for Testing
[env.staging]
name = "grant-search-api-staging"

# Staging feature flags - Test live federal data and real AI
[env.staging.vars]
ENVIRONMENT = "staging"
FEATURE_LIVE_DATA = true
FEATURE_REAL_AI = true

[[env.staging.d1_databases]]
binding = "VOIDCAT_DB"
database_name = "voidcat-users"
database_id = "b22bd380-29ca-4a22-be8a-655a382a58a1"

[[env.staging.kv_namespaces]]
binding = "OAUTH_KV"
id = "ae1f4c3087dd4b208a449f7fbd7c93d3"

[[env.staging.r2_buckets]]
binding = "ASSETS"
bucket_name = "voidcat-assets"

# Stripe Configuration - Standardized Environment Variables
# Set these via Cloudflare Workers secrets (recommended)
# STRIPE_SECRET_KEY = "sk_live_..." # Primary: Set via: wrangler secret put STRIPE_SECRET_KEY
# STRIPE_PUBLISHABLE_KEY = "pk_live_..." # Primary: Set via: wrangler secret put STRIPE_PUBLISHABLE_KEY  
# STRIPE_PRICE_ID = "price_..." # Primary: Set via: wrangler secret put STRIPE_PRICE_ID
# STRIPE_WEBHOOK_SECRET = "whsec_..." # Primary: Set via: wrangler secret put STRIPE_WEBHOOK_SECRET

# Phase 2A: AI API Keys (Set via Cloudflare secrets)
# ANTHROPIC_API_KEY = "sk-ant-..." # Set via: wrangler secret put ANTHROPIC_API_KEY
# OPENAI_API_KEY = "sk-proj-..." # Set via: wrangler secret put OPENAI_API_KEY
# These are configured by scripts/setup-phase2a.sh

# Legacy variable names (supported for backward compatibility):
# STRIPE_SK = "sk_live_..." # Fallback for STRIPE_SECRET_KEY
# STRIPE_PUBLIC_KEY = "pk_live_..." # Fallback for STRIPE_PUBLISHABLE_KEY
# STRIPE_PRODUCT_PRICE_ID = "price_..." # Fallback for STRIPE_PRICE_ID
# STRIPE_WH_SECRET = "whsec_..." # Fallback for STRIPE_WEBHOOK_SECRET

# See ENVIRONMENT-VARIABLES.md for complete configuration guide

[[env.production.d1_databases]]
binding = "VOIDCAT_DB"
database_name = "voidcat-users"
database_id = "b22bd380-29ca-4a22-be8a-655a382a58a1"

[[env.production.kv_namespaces]]
binding = "OAUTH_KV"
id = "ae1f4c3087dd4b208a449f7fbd7c93d3"

[[env.production.r2_buckets]]
binding = "ASSETS"
bucket_name = "voidcat-assets"