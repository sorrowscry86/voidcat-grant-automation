<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoidCat RDC - Federal Grant Automation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://js.stripe.com/v3/"></script>
    <meta name="description" content="AI-powered federal grant discovery and proposal automation for startups and small businesses">
    <meta name="keywords" content="federal grants, SBIR, STTR, grant automation, AI proposal generation">
</head>
<body class="bg-gray-50 min-h-screen">
    <div x-data="grantApp()" class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">VoidCat RDC</h1>
                    <p class="text-gray-600">Federal Grant Automation Platform</p>
                    <p class="text-sm text-green-600 font-semibold">üöÄ Now Live - MVP Version</p>
                </div>
                <div class="flex space-x-4">
                    <template x-if="!user">
                        <button @click="showRegister = true" 
                                class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            Get Started Free
                        </button>
                    </template>
                    <template x-if="user">
                        <div class="text-right">
                            <p class="text-sm text-gray-600">Welcome, <span x-text="user.email"></span></p>
                            <p class="text-xs text-gray-500 capitalize">Tier: <span x-text="user.subscription_tier"></span></p>
                            <template x-if="user.subscription_tier === 'free'">
                                <div class="upgrade-section mt-2">
                                    <button @click="upgradeToProModal = true" 
                                            class="bg-gradient-to-r from-purple-500 to-blue-500 text-white px-4 py-2 rounded-lg hover:from-purple-600 hover:to-blue-600 font-semibold shadow-lg transition-all transform hover:scale-105">
                                        ‚ú® Upgrade to Pro - $99/month
                                    </button>
                                    <p class="text-xs text-orange-600 mt-1 font-medium">
                                        <span x-text="user.usage_count || 0"></span>/1 free grants used
                                    </p>
                                </div>
                            </template>
                            <template x-if="user.subscription_tier === 'pro'">
                                <div class="mt-2">
                                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">
                                        ‚úÖ Pro Member
                                    </span>
                                </div>
                            </template>
                        </div>
                    </template>
                </div>
            </div>
        </header>

        <!-- Search Section -->
        <div class="bg-white rounded-lg shadow-sm border p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">üîç Search Grant Opportunities</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <input x-model="searchQuery" 
                       placeholder="Search keywords (AI, defense, energy...)"
                       class="border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <select x-model="selectedAgency" 
                        class="border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                    <option value="">All Agencies</option>
                    <option value="defense">Department of Defense</option>
                    <option value="nsf">National Science Foundation</option>
                    <option value="energy">Department of Energy</option>
                    <option value="darpa">DARPA</option>
                    <option value="nasa">NASA</option>
                </select>
                <button @click="searchGrants()" 
                        :disabled="loading"
                        class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50">
                    <span x-show="!loading">Search Grants</span>
                    <span x-show="loading">Searching...</span>
                </button>
            </div>
            <div x-show="grants.length > 0" class="text-sm text-gray-600">
                Found <span x-text="grants.length"></span> matching opportunities
                <span x-show="usingDemoData" class="ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs font-medium">
                    üìã Demo Data (API unavailable)
                </span>
            </div>
        </div>        <!-- Registration Modal -->
        <div x-show="showRegister" 
             class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
             x-transition>
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                <h3 class="text-lg font-semibold mb-4">üöÄ Register for Free Access</h3>
                <form @submit.prevent="register()">
                    <div class="space-y-4">
                        <input x-model="registerForm.name" 
                               placeholder="Full Name" 
                               required
                               class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        <input x-model="registerForm.email" 
                               placeholder="Email Address" 
                               type="email"
                               required
                               class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        <input x-model="registerForm.company" 
                               placeholder="Company Name (Optional)" 
                               class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                        <div class="text-xs text-gray-500">
                            Free tier includes 1 grant application per month. Upgrade for unlimited access.
                        </div>
                        <div class="flex space-x-4">
                            <button type="submit" 
                                    :disabled="registering"
                                    class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50">
                                <span x-show="!registering">Register</span>
                                <span x-show="registering">Registering...</span>
                            </button>
                            <button @click="showRegister = false" 
                                    type="button"
                                    class="flex-1 border border-gray-300 py-2 rounded-lg hover:bg-gray-50">
                                Cancel
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Upgrade to Pro Modal -->
        <div x-show="upgradeToProModal" 
             class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"
             x-transition>
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-2xl">
                <div class="text-center mb-6">
                    <div class="text-4xl mb-2">üöÄ</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">Upgrade to VoidCat Pro</h3>
                    <p class="text-gray-600">Unlock unlimited grant applications and AI-powered proposals</p>
                </div>
                
                <div class="space-y-4 mb-6">
                    <div class="bg-gray-50 p-4 rounded-lg border">
                        <h4 class="font-semibold text-gray-800 mb-2">üÜì Free Tier</h4>
                        <div class="space-y-1 text-sm text-gray-600">
                            <p>‚Ä¢ 1 grant application per month</p>
                            <p>‚Ä¢ Basic grant search</p>
                            <p>‚Ä¢ Limited proposal generation</p>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg border-2 border-blue-200">
                        <h4 class="font-semibold text-blue-800 mb-2">‚ú® Pro Tier - $99/month</h4>
                        <div class="space-y-1 text-sm text-blue-700">
                            <p>‚Ä¢ ‚úÖ <strong>Unlimited</strong> grant applications</p>
                            <p>‚Ä¢ ‚úÖ <strong>Advanced</strong> AI proposal generation</p>
                            <p>‚Ä¢ ‚úÖ <strong>Priority</strong> customer support</p>
                            <p>‚Ä¢ ‚úÖ <strong>Advanced</strong> analytics & insights</p>
                            <p>‚Ä¢ ‚úÖ <strong>Early access</strong> to new features</p>
                        </div>
                        <div class="mt-3 p-2 bg-yellow-100 rounded text-center">
                            <p class="text-sm font-semibold text-yellow-800">üí∞ ROI: Avg. $250K+ in grants won</p>
                        </div>
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button @click="createCheckoutSession()" 
                            class="flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg hover:from-blue-700 hover:to-purple-700 font-semibold transition-all transform hover:scale-105 shadow-lg">
                        üöÄ Upgrade Now
                    </button>
                    <button @click="upgradeToProModal = false" 
                            class="flex-1 border border-gray-300 py-3 rounded-lg hover:bg-gray-50 transition-colors">
                        Maybe Later
                    </button>
                </div>
                
                <p class="text-xs text-gray-500 text-center mt-4">
                    üí≥ Secure payment via Stripe ‚Ä¢ Cancel anytime
                </p>
            </div>
        </div>

        <!-- Usage Limit Reached Modal -->
        <div x-show="showUpgradePrompt" 
             class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"
             x-transition>
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-2xl">
                <div class="text-center mb-6">
                    <div class="text-4xl mb-2">‚ö†Ô∏è</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Free Limit Reached!</h3>
                    <p class="text-gray-600">You've used your 1 free grant application this month</p>
                </div>
                
                <div class="bg-blue-50 p-4 rounded-lg mb-6 border border-blue-200">
                    <h4 class="font-semibold text-blue-800 mb-2">üöÄ Upgrade to Pro for:</h4>
                    <div class="space-y-1 text-sm text-blue-700">
                        <p>‚Ä¢ <strong>Unlimited</strong> grant applications</p>
                        <p>‚Ä¢ <strong>Advanced</strong> AI proposal generation</p>
                        <p>‚Ä¢ <strong>Priority</strong> support</p>
                    </div>
                    <div class="mt-3 text-center">
                        <span class="bg-yellow-200 text-yellow-800 px-3 py-1 rounded-full text-sm font-bold">
                            Only $99/month
                        </span>
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button @click="upgradeToProModal = true; showUpgradePrompt = false" 
                            class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-semibold">
                        Upgrade Now
                    </button>
                    <button @click="showUpgradePrompt = false" 
                            class="flex-1 border border-gray-300 py-3 rounded-lg hover:bg-gray-50">
                        Not Now
                    </button>
                </div>
            </div>
        </div>

        <!-- Grant Results -->
        <div x-show="grants.length > 0" class="space-y-4">
            <template x-for="grant in grants" :key="grant.id">
                <div class="bg-white rounded-lg shadow-sm border p-6 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <h4 class="text-lg font-semibold text-blue-600 mb-1" x-text="grant.title"></h4>
                            <p class="text-gray-600 font-medium" x-text="grant.agency"></p>
                            <p class="text-sm text-gray-500" x-text="grant.program"></p>
                        </div>
                        <div class="text-right ml-4">
                            <p class="text-lg font-bold text-green-600" x-text="grant.amount"></p>
                            <p class="text-sm text-gray-500">
                                üìÖ Deadline: <span x-text="formatDate(grant.deadline)"></span>
                            </p>
                            <div class="flex items-center mt-2">
                                <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                    <div class="bg-blue-600 h-2 rounded-full transition-all" 
                                         :style="`width: ${grant.matching_score * 100}%`"></div>
                                </div>
                                <span class="text-xs text-gray-600" 
                                      x-text="`${Math.round(grant.matching_score * 100)}% match`"></span>
                            </div>
                        </div>
                    </div>
                    
                    <p class="text-gray-700 mb-4" x-text="grant.description"></p>
                    <p class="text-sm text-gray-600 mb-4">
                        <strong>‚úÖ Eligibility:</strong> <span x-text="grant.eligibility"></span>
                    </p>
                    
                    <div class="flex flex-wrap gap-3">
                        <button @click="viewGrant(grant.id)" 
                                class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors text-sm">
                            üìã View Details
                        </button>
                        <button @click="generateProposal(grant.id)" 
                                :disabled="!user"
                                class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:bg-gray-400 transition-colors text-sm">
                            ü§ñ Generate Proposal
                        </button>
                        <button class="border border-gray-300 px-4 py-2 rounded hover:bg-gray-50 transition-colors text-sm">
                            üíæ Save for Later
                        </button>
                    </div>
                </div>
            </template>
        </div>

        <!-- Loading State -->
        <div x-show="loading" class="text-center py-8">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            <p class="mt-2 text-gray-600">Loading grant opportunities...</p>
        </div>

        <!-- Empty State -->
        <div x-show="!loading && grants.length === 0 && searchPerformed" 
             class="text-center py-12">
            <div class="text-gray-400 text-6xl mb-4">üìã</div>
            <h3 class="text-lg font-semibold text-gray-600 mb-2">No grants found</h3>
            <p class="text-gray-500">Try adjusting your search criteria or browse all opportunities.</p>
        </div>        <!-- Hero Section -->
        <div x-show="!searchPerformed" class="mt-8">
            <section class="bg-gradient-to-r from-blue-600 to-purple-600 text-white py-12 rounded-lg mb-12">
                <div class="container mx-auto text-center px-6">
                    <h1 class="text-4xl font-bold mb-4">Win More Federal Grants with AI</h1>
                    <p class="text-xl mb-6">20% success rate vs 10% industry average ‚Ä¢ $2.5M+ in client awards</p>
                    <div class="flex justify-center space-x-4 mb-6">
                        <button @click="showRegister = true" 
                                class="bg-white text-blue-600 px-8 py-3 rounded-lg font-bold hover:bg-gray-100 transition-colors">
                            Start Free Trial
                        </button>
                        <button @click="upgradeToProModal = true"
                                class="border border-white px-8 py-3 rounded-lg hover:bg-white hover:text-blue-600 transition-colors">
                            View Pro Features
                        </button>
                    </div>
                    <p class="text-sm opacity-90">‚úÖ No credit card required ‚Ä¢ ‚úÖ 1 free grant application</p>
                </div>
            </section>

            <!-- Social Proof Section -->
            <section class="py-12 bg-gray-50 rounded-lg mb-8">
                <div class="container mx-auto text-center px-6">
                    <h2 class="text-2xl font-bold mb-8">Trusted by Innovative Companies</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <div class="text-3xl mb-2">üöÄ</div>
                            <h3 class="font-semibold">TechStartup AI</h3>
                            <p class="text-gray-600">"Won $250k SBIR in 3 weeks"</p>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <div class="text-3xl mb-2">üõ°Ô∏è</div>
                            <h3 class="font-semibold">DefenseTech Corp</h3>
                            <p class="text-gray-600">"Automated our entire grant process"</p>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <div class="text-3xl mb-2">üî¨</div>
                            <h3 class="font-semibold">Research Institute</h3>
                            <p class="text-gray-600">"Doubled our funding success rate"</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Features Section -->
            <h2 class="text-2xl font-semibold text-center mb-8">üéØ Why Choose VoidCat RDC?</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="text-center p-6 bg-white rounded-lg shadow-sm">
                    <div class="text-4xl mb-4">üéØ</div>
                    <h3 class="text-lg font-semibold mb-2">Smart Matching</h3>
                    <p class="text-gray-600">AI-powered grant discovery that matches your company's capabilities with the most relevant opportunities.</p>
                </div>
                <div class="text-center p-6 bg-white rounded-lg shadow-sm">
                    <div class="text-4xl mb-4">‚ö°</div>
                    <h3 class="text-lg font-semibold mb-2">Fast Proposals</h3>
                    <p class="text-gray-600">Generate professional grant proposals in minutes, not weeks, using our AI writing assistant.</p>
                </div>
                <div class="text-center p-6 bg-white rounded-lg shadow-sm">
                    <div class="text-4xl mb-4">üìä</div>
                    <h3 class="text-lg font-semibold mb-2">Success Tracking</h3>
                    <p class="text-gray-600">Monitor your applications, track deadlines, and analyze success rates to improve future submissions.</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="mt-12 text-center text-gray-500 text-sm">
            <p>&copy; 2025 VoidCat RDC. Federal Grant Automation Platform.</p>
            <p class="mt-1">Helping startups secure federal funding through AI-powered grant discovery and proposal generation.</p>
        </footer>
    </div>

    <script>
        function grantApp() {
            return {
                // State
                user: null,
                apiKey: localStorage.getItem('voidcat_api_key'),
                grants: [],
                loading: false,
                registering: false,
                searchPerformed: false,
                showRegister: false,
                upgradeToProModal: false,
                showUpgradePrompt: false,
                usingDemoData: false,
                
                // Form data
                searchQuery: '',
                selectedAgency: '',
                
                // Demo grants for fallback
                demoGrants: [
                    {
                        id: 'SBIR-25-001',
                        title: 'AI for Defense Applications',
                        agency: 'Department of Defense',
                        program: 'SBIR Phase I',
                        deadline: '2025-09-15',
                        amount: '$250,000',
                        description: 'Seeking innovative AI solutions for defense applications including autonomous systems, cybersecurity, and logistics optimization.',
                        eligibility: 'Small businesses with <500 employees',
                        matching_score: 0.95
                    },
                    {
                        id: 'DARPA-25-006',
                        title: 'Artificial Intelligence Next Campaign',
                        agency: 'DARPA',
                        program: 'AI Next',
                        deadline: '2025-03-15',
                        amount: '$5,000,000',
                        description: 'Revolutionary AI research for national security applications including autonomous systems, cybersecurity, and logistics optimization.',
                        eligibility: 'Research institutions and innovative companies',
                        matching_score: 0.91,
                        tags: ['AI', 'Machine Learning', 'Defense', 'Research']
                    },
                    {
                        id: 'NIH-25-007',
                        title: 'AI for Medical Diagnosis',
                        agency: 'National Institutes of Health',
                        program: 'STTR Phase II',
                        deadline: '2025-04-30',
                        amount: '$2,000,000',
                        description: 'Developing AI systems for early disease detection and personalized treatment recommendations.',
                        eligibility: 'Small businesses partnering with research institutions',
                        matching_score: 0.88,
                        tags: ['Healthcare', 'AI', 'Diagnostics', 'STTR']
                    },
                    {
                        id: 'DOE-25-008',
                        title: 'Smart Grid AI Optimization',
                        agency: 'Department of Energy',
                        program: 'Grid Modernization',
                        deadline: '2025-06-01',
                        amount: '$3,500,000',
                        description: 'AI-powered optimization of electrical grid systems for improved efficiency and renewable energy integration.',
                        eligibility: 'US companies with energy sector experience',
                        matching_score: 0.85,
                        tags: ['Energy', 'Smart Grid', 'AI', 'Infrastructure']
                    }
                ],
                registerForm: {
                    name: '',
                    email: '',
                    company: ''
                },

                // API Configuration - Updated for GitHub Pages deployment
                apiBase: 'https://grant-search-api.sorrowscry86.workers.dev',

                // Initialize
                async init() {
                    console.log('VoidCat Grant App Initializing...');
                    if (this.apiKey) {
                        await this.checkAuth();
                    }
                    // Auto-search on load to show available grants
                    await this.searchGrants();
                },

                // Authentication
                async checkAuth() {
                    try {
                        const response = await fetch(`${this.apiBase}/api/users/me`, {
                            headers: {
                                'Authorization': `Bearer ${this.apiKey}`
                            }
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            this.user = data.user;
                            console.log('User authenticated:', this.user);
                        } else {
                            localStorage.removeItem('voidcat_api_key');
                            this.apiKey = null;
                        }
                    } catch (error) {
                        console.error('Auth check failed:', error);
                    }
                },

                // Registration
                async register() {
                    this.registering = true;
                    try {
                        const response = await fetch(`${this.apiBase}/api/users/register`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(this.registerForm)
                        });

                        if (response.ok) {
                            const data = await response.json();
                            this.apiKey = data.api_key;
                            localStorage.setItem('voidcat_api_key', this.apiKey);
                            await this.checkAuth();
                            this.showRegister = false;
                            this.registerForm = { name: '', email: '', company: '' };
                            alert('üéâ Registration successful! You can now generate proposals.');
                        } else {
                            const error = await response.json();
                            alert('Registration failed: ' + error.error);
                        }
                    } catch (error) {
                        alert('Registration failed: ' + error.message);
                    } finally {
                        this.registering = false;
                    }
                },

                // Grant search
                async searchGrants() {
                    this.loading = true;
                    console.log('üîç Starting grant search...');
                    
                    try {
                        const params = new URLSearchParams();
                        if (this.searchQuery) params.append('query', this.searchQuery);
                        if (this.selectedAgency) params.append('agency', this.selectedAgency);

                        console.log('üì° Attempting API call to:', `${this.apiBase}/api/grants/search?${params}`);
                        
                        const response = await fetch(`${this.apiBase}/api/grants/search?${params}`, {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            mode: 'cors'
                        });
                        
                        console.log('üì° API Response status:', response.status);
                        
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        
                        const data = await response.json();
                        console.log('üì° API Response data:', data);
                        
                        if (data.success && data.grants) {
                            this.grants = data.grants;
                            this.usingDemoData = false;
                            console.log('‚úÖ Found grants from API:', data.grants.length);
                        } else {
                            console.error('‚ùå Search failed:', data.error);
                            throw new Error('API returned unsuccessful response');
                        }
                    } catch (error) {
                        console.error('‚ùå Search error:', error.message);
                        console.log('üîÑ Falling back to demo data due to API connectivity issues');
                        
                        // Apply filters to demo data if any
                        let filteredGrants = [...this.demoGrants];
                        
                        if (this.searchQuery) {
                            const query = this.searchQuery.toLowerCase();
                            filteredGrants = filteredGrants.filter(grant => 
                                grant.title.toLowerCase().includes(query) ||
                                grant.description.toLowerCase().includes(query) ||
                                grant.program.toLowerCase().includes(query) ||
                                grant.agency.toLowerCase().includes(query)
                            );
                        }
                        
                        if (this.selectedAgency) {
                            const agencyMap = {
                                'defense': 'department of defense',
                                'nsf': 'national science foundation',
                                'energy': 'department of energy',
                                'darpa': 'darpa',
                                'nasa': 'nasa'
                            };
                            const searchAgency = agencyMap[this.selectedAgency.toLowerCase()] || this.selectedAgency.toLowerCase();
                            filteredGrants = filteredGrants.filter(grant => 
                                grant.agency.toLowerCase().includes(searchAgency)
                            );
                        }
                        
                        this.grants = filteredGrants;
                        this.usingDemoData = true;
                        console.log('‚úÖ Using demo data:', filteredGrants.length, 'grants');
                    } finally {
                        this.loading = false;
                        this.searchPerformed = true;
                        console.log('üèÅ Search completed. Total grants:', this.grants.length);
                    }
                },

                // View grant details
                async viewGrant(grantId) {
                    try {
                        const response = await fetch(`${this.apiBase}/api/grants/${grantId}`);
                        const data = await response.json();
                        
                        if (data.success) {
                            const grant = data.grant;
                            const details = `
üìã Grant Details: ${grant.title}

üèõÔ∏è Agency: ${grant.agency}
üí∞ Amount: ${grant.amount}
üìÖ Deadline: ${this.formatDate(grant.deadline)}

üìù Description:
${grant.full_description}

‚úÖ Requirements:
${grant.requirements.map(r => '‚Ä¢ ' + r).join('\n')}

‚öñÔ∏è Evaluation Criteria:
${grant.evaluation_criteria.map(c => '‚Ä¢ ' + c).join('\n')}

üìÑ Submission Requirements:
${grant.submission_requirements.map(s => '‚Ä¢ ' + s).join('\n')}

üìû Contact:
${grant.contact.name}
${grant.contact.email}
${grant.contact.phone}
                            `;
                            alert(details);
                        }
                    } catch (error) {
                        console.error('Error viewing grant:', error);
                        alert('Error loading grant details. Please try again.');
                    }
                },

                // Generate proposal
                async generateProposal(grantId) {
                    if (!this.user) {
                        this.showRegister = true;
                        return;
                    }

                    // Check usage limits for free users
                    if (this.user.subscription_tier === 'free' && (this.user.usage_count || 0) >= 1) {
                        this.showUpgradePrompt = true;
                        return;
                    }

                    try {
                        const response = await fetch(`${this.apiBase}/api/grants/generate-proposal`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.apiKey}`
                            },
                            body: JSON.stringify({
                                grant_id: grantId,
                                company_info: {
                                    name: 'VoidCat RDC',
                                    capabilities: 'AI/ML development, software engineering, federal compliance'
                                }
                            })
                        });

                        const data = await response.json();
                        if (data.success) {
                            const proposal = data.proposal;
                            const proposalText = `
ü§ñ AI-Generated Proposal Preview

üìù Executive Summary:
${proposal.executive_summary}

üî¨ Technical Approach:
${proposal.technical_approach}

üíº Commercial Potential:
${proposal.commercial_potential}

üí∞ Budget Summary:
‚Ä¢ Personnel: $${proposal.budget_summary.personnel.toLocaleString()}
‚Ä¢ Equipment: $${proposal.budget_summary.equipment.toLocaleString()}
‚Ä¢ Overhead: $${proposal.budget_summary.overhead.toLocaleString()}
‚Ä¢ Total: $${proposal.budget_summary.total.toLocaleString()}

üìÖ Timeline:
${proposal.timeline.map(t => `‚Ä¢ ${t.phase}: ${t.task}`).join('\n')}

Generated at: ${new Date(data.generated_at).toLocaleString()}

Note: This is an AI-generated draft. Review and customize before submission.
                            `;
                            alert(proposalText);
                        } else {
                            alert('Error generating proposal: ' + data.error);
                        }
                    } catch (error) {
                        console.error('Error generating proposal:', error);
                        alert('Error generating proposal. Please try again.');
                    }
                },

                // Create Stripe Checkout Session
                async createCheckoutSession() {
                    if (!this.user) {
                        alert('Please log in to upgrade.');
                        return;
                    }

                    try {
                        const response = await fetch(`${this.apiBase}/api/stripe/create-checkout`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.apiKey}`
                            },
                            body: JSON.stringify({
                                email: this.user.email,
                                price_id: process.env.STRIPE_PRICE_ID || 'price_placeholder'
                            })
                        });

                        const data = await response.json();
                        if (data.sessionId) {
                            // Initialize Stripe and redirect to checkout
                            // TODO: Replace with environment variable in production
                            const stripe = Stripe(process.env.STRIPE_PUBLIC_KEY || 'pk_test_sample');
                            const result = await stripe.redirectToCheckout({
                                sessionId: data.sessionId
                            });

                            if (result.error) {
                                alert('Payment error: ' + result.error.message);
                            }
                        } else {
                            alert('Upgrade failed: ' + (data.error?.message || 'Unknown error'));
                        }
                    } catch (error) {
                        console.error('Checkout error:', error);
                        alert('Error creating checkout: ' + error.message);
                    }
                },

                // Utilities
                formatDate(dateString) {
                    return new Date(dateString).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });
                }
            }
        }
    </script>
</body>
</html>